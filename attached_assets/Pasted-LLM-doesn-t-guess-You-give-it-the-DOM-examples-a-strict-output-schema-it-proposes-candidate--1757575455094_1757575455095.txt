LLM doesn’t “guess.” You give it the DOM + examples + a strict output schema, it proposes candidate CSS selectors per field, and we auto-verify those in the page before we trust them. If a candidate fails, we demote it and try the next. That’s how it “knows.”


Here’s the playbook that works:


What we feed the LLM

    HTML slice of the page (head + top of body + any #gallery/#price chunks we can cheaply grab).

    The target label: "title" | "price" | "brand" | "description" | "images".

    Few-shot patterns so it recognizes standard ecommerce markup:

        script[type="application/ld+json"] → Product.name, offers.price, image[], brand.name.

        Microdata: [itemprop="price"], [itemprop="name"], [itemprop="brand"].

        Common attributes: data-testid="price", .price, .money, .gallery img, .product-title.

    Output contract: json with candidates[] (CSS selectors), strongest first, and optional notes.


What the LLM returns


Example for price:

{
"label": "price",
"candidates": [
"script[type='application/ld+json'] :nth-child(1) :nth-child(3) :nth-child(2) [itemprop='offers'] [itemprop='price']",
"[itemprop='price']",
"[data-testid='price']",
".price .money"
]
}


For title: h1, LD-JSON name; brand: LD-JSON brand.name/[itemprop='brand']; description: meta[name='description'] then LD-JSON; images: .gallery img, LD-JSON image[], meta[property='og:image'].)


How we decide what’s “right”


We execute each selector in the page context and score it:

    Title

        Text length 5–180, not all caps, no nav/footer matches.

    Price

        Numeric parse succeeds, currency symbol allowed, within sane bounds ($1–$10K), if multiple numbers in block → take min (handles “$155 now $42.99”).

    Brand

        Short token, no “Inc.”/“LLC” unless LD-JSON says so.

    Description

        ≥ 60 chars, ends with punctuation, strip marketing boilerplate.

    Images

        Keep only http/https with ext (jpg|jpeg|png|webp|avif|gif) or known CDN format= params; drop data:/sprites/logos; dedupe canonical filename.


If a candidate fails validation, we try the next

